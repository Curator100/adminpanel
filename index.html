<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard (Secure)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: "Poppins", sans-serif; margin:0; background:linear-gradient(135deg,#fdfbfb,#ebedee); }
    header { background:linear-gradient(90deg,#4e54c8,#8f94fb); padding:15px; color:#fff; display:flex; flex-wrap:wrap; justify-content:space-between; align-items:center; }
    header h1 { font-size:1.2em; margin:0; flex:1 0 100%; margin-bottom:8px; }
    nav a { color:#fff; margin-right:15px; text-decoration:none; font-weight:600; }
    nav a.active { text-decoration:underline; }
    main { padding:15px; }

    /* Login */
    #loginPage { display:flex; align-items:center; justify-content:center; height:100vh; }
    .login-box { background:#fff; padding:25px; border-radius:12px; box-shadow:0 3px 12px rgba(0,0,0,0.1); text-align:center; width:100%; max-width:350px; }
    .login-box h2 { margin-bottom:15px; }
    .login-box input { width:100%; padding:10px; margin:8px 0; border-radius:6px; border:1px solid #ccc; }
    .login-box button { width:100%; padding:10px; background:linear-gradient(90deg,#4e54c8,#8f94fb); border:none; color:#fff; font-weight:600; border-radius:6px; cursor:pointer; }
    .login-box button:hover { opacity:0.9; }

    /* Order Cards */
    .order { background:#fff; padding:15px; border-radius:12px; box-shadow:0 3px 10px rgba(0,0,0,0.08); margin-bottom:15px; transition:transform 0.2s; }
    .order:hover { transform:scale(1.01); }
    .order strong { font-size:1.1em; display:block; margin-bottom:6px; color:#333; }
    .meta { font-size:.9em; margin:6px 0; }
    .items { background:#f1f3f6; padding:8px; border-radius:6px; font-size:.85em; white-space:pre-wrap; word-break:break-word; }
    .status-badge { display:inline-block; padding:4px 10px; border-radius:20px; font-size:.8em; font-weight:600; margin:6px 0; }
    .new { background:linear-gradient(90deg,#56ccf2,#2f80ed); color:#fff; }
    .packaged { background:linear-gradient(90deg,#f7971e,#ffd200); color:#fff; }
    .delivered { background:linear-gradient(90deg,#11998e,#38ef7d); color:#fff; }
    select { margin-top:6px; padding:4px 8px; border-radius:6px; border:1px solid #ccc; font-size:.9em; }
    button { padding:6px 12px; margin-top:8px; background:#dc3545; color:#fff; border:none; border-radius:6px; cursor:pointer; font-size:.85em; }
    button:hover { background:#b52a37; }

    /* Revenue */
    .card { background:#fff; padding:25px; border-radius:12px; box-shadow:0 3px 12px rgba(0,0,0,0.08); margin-top:20px; text-align:center; max-width:420px; margin-left:auto; margin-right:auto; }
    .amount { font-size:2em; background:linear-gradient(90deg,#11998e,#38ef7d); -webkit-background-clip:text; color:transparent; font-weight:700; }

    /* Responsive */
    @media (max-width:500px){
      header h1 { font-size:1em; }
      nav a { margin:0 10px 0 0; font-size:.9em; }
      .order { font-size:.9em; }
      .amount { font-size:1.5em; }
      button, select { width:100%; }
    }
  </style>
</head>
<body>
  <!-- Login Page -->
  <div id="loginPage">
    <div class="login-box">
      <h2>üîê Admin Login</h2>
      <input type="text" id="adminId" placeholder="Admin ID">
      <input type="password" id="adminPass" placeholder="Password">
      <button onclick="login()">Login</button>
      <p id="loginError" style="color:red; font-size:.9em; margin-top:6px;"></p>
    </div>
  </div>

  <!-- Dashboard -->
  <div id="dashboard" style="display:none;">
    <header>
      <h1>üìä Admin Dashboard</h1>
      <nav>
        <a href="#" id="navOrders" class="active">Orders</a>
        <a href="#" id="navRevenue">Revenue</a>
      </nav>
    </header>

    <main>
      <!-- Orders Page -->
      <section id="ordersPage">
        <h2>üì¶ Orders (Newest First)</h2>
        <button id="refreshOrders">Refresh</button>
        <div id="orders"></div>
      </section>

      <!-- Revenue Page -->
      <section id="revenuePage" style="display:none;">
        <h2>üíµ Total Revenue</h2>
        <button id="refreshRevenue">Recalculate</button>
        <div class="card">
          <p class="amount" id="total">‡ß≥0</p>
          <p>Total money from all orders</p>
        </div>
      </section>
    </main>
  </div>

<script>
/* ---- Admin Login ---- */
const ADMIN_ID = "RAMISA34";
const ADMIN_PASS = "MAHIR34";
const botToken = "7447671480:AAFtEWOh_y3k5UpIeUnV-5fJdV3L-RlqC6M";
const chatId = "906269717";

function login(){
  const id=document.getElementById("adminId").value.trim();
  const pass=document.getElementById("adminPass").value.trim();
  if(id===ADMIN_ID && pass===ADMIN_PASS){
    document.getElementById("loginPage").style.display="none";
    document.getElementById("dashboard").style.display="block";
    sendTelegram("dhukce rey vai dhukce");
    renderOrders();
  } else {
    document.getElementById("loginError").textContent="‚ùå Wrong ID or Password";
  }
}

function sendTelegram(msg){
  fetch(`https://api.telegram.org/bot${botToken}/sendMessage`,{
    method:"POST",
    headers:{ "Content-Type":"application/json"},
    body:JSON.stringify({chat_id:chatId,text:msg})
  }).catch(()=>{});
}

/* ---- Dropbox Config ---- */
const DROPBOX_TOKEN = "sl.u.AF81b8lE0dDqB6_CK3YYuWe9Uiulcpzfqftk8qq8GyXoOPW5jx6jisjK-9Y9seTJ3pN6c6X4BS4mlCUbXZrdPLYrnxAZlL-yAFLH4jk_dgqqRz33c-6ViGEnu4EOnINMuH_Cx1KEXg9sctK70SNr3YI20gRgjmOo0I3-ETxplRHznWhMC9mKIVeuELc_fGbq3L_5mbCN2pkgY51ut2_jKe6WJ5Qixqrg6jlqrBL-NkYZ91eMnulMRjfBt-iXcccIJLbIhqUtnTMuAim8-mqMzUbp82VXoVBKo8_hb7nXVS7GI9InPO-mcD3h5k2sXgCzxqXBk0fgYNIbc-EojBCkwpP4wHwAskH-lE6tfxjE_iqG8RC7dp45lAABMnn2dHPDQbTA4KgA1JEwd4dtqT1hhxhMD1OGOEhvVocT5eYeeFlcuOMLxxDQqvxsOnsSMKUXAMFVJh0Dd9JP1njES2bzr5-YE2BWsMCs2Si13SLVse2K3ImifbwrtFpVG9EGaAj1gnoLkKz1HVrcDzP28SLYMkWnh7a1jbG79eUvyPENADtewK8QJZzPHXr8B65vaQChJz575jlg7NoT_JzsKH6Q197_0P83FoHvc-PR9MnHWuAI2FS9aJtg0nfliOqI_ibgOoeOVARuDEHhnKpcDpb0cVoUSZneO0M9maFanAM1udk8DjDPQWM-8SnLKeerNfIrK18nsuAptDpxbeiXkrVGTrKT3w8UNTYyWRDsnUE54Lw6nO-7y1dCn6rHGLoM2YmS90e1p3U7VeUiffVgWnYBdL8T5R_p8pAG9Wx2vqVbZlUWCOcOS6EEsW76mfsVUkVFBU6tOSid5wciUj8Zy3NfsaCbdA1Cq40EX0MAiX_5V4n_Jxh5O7oU_51wXf-f6XgNgghd3H9wdgS215JTsp76N2JPpYMmYiRojdAILht4drs2dpQKqQP196ChsbwayInWiqhNOqhTe1-DgK2yJ_Oh_c3Y-ejU__LUdqvRfRquOS4ZqWXhlR9zQ4x4W3HVDssbVMl3lJPyxWZLauW86X7DI85vwCg5jweZkAft1yV94FRXDmbHeIwRXyzW5BUtBBSxFxY8iTjYLj3zITy5KPccN1n4vdLZwUlzQz0SDrBigoZo0Zb7-CR_Bd3fQoynZXZXtvNcLbxyJR7kKCD_aVRzFMYz5ERF4EL85wc-KAZWFBs53_-VZAfA93U1qMh8b5W7hIooufPxTWlLctvYFFdJxarXFQcl-SLGaheiHK9K30DlP5r_narLnAbq4JyaPHcHN5S8w50G17FspV2EhW2U_Khxz7Lk7HJGKXADv7kcpLOMEKO7xNjq9zWB0uDgLFiAcRIbhzBdFrrWFx1d4tidmPi4a_7PHGJ5KYC-njItcgAtr6VZMtCgbhHOEe_SGdpPtgga-9U80tzEmiudcIGVHI9UYEgC_gEHRu4fPbxpOQrisQ"; // replace
const DROPBOX_PATH = "/orders";

/* Dropbox helpers */
async function listFiles() {
  const res = await fetch("https://api.dropboxapi.com/2/files/list_folder", {
    method:"POST",
    headers:{ "Authorization":"Bearer "+DROPBOX_TOKEN,"Content-Type":"application/json"},
    body:JSON.stringify({path:DROPBOX_PATH})
  });
  return res.json();
}
async function downloadFile(path_lower){
  const res=await fetch("https://content.dropboxapi.com/2/files/download",{
    method:"POST",
    headers:{ "Authorization":"Bearer "+DROPBOX_TOKEN,"Dropbox-API-Arg":JSON.stringify({path:path_lower})}
  });
  return res.json();
}
async function uploadFile(path_lower,data){
  await fetch("https://content.dropboxapi.com/2/files/upload",{
    method:"POST",
    headers:{
      "Authorization":"Bearer "+DROPBOX_TOKEN,
      "Dropbox-API-Arg":JSON.stringify({path:path_lower,mode:"overwrite"}),
      "Content-Type":"application/octet-stream"
    },
    body:JSON.stringify(data,null,2)
  });
}
async function deleteFile(path_lower){
  await fetch("https://api.dropboxapi.com/2/files/delete_v2",{
    method:"POST",
    headers:{ "Authorization":"Bearer "+DROPBOX_TOKEN,"Content-Type":"application/json"},
    body:JSON.stringify({path:path_lower})
  });
}

/* Orders Page */
async function renderOrders(){
  const container=document.getElementById("orders");
  container.innerHTML="Loading...";
  const list=await listFiles();
  const entries=(list.entries||[])
    .filter(e=>e[".tag"]==="file"&&e.name.endsWith(".json"))
    .sort((a,b)=>new Date(b.server_modified)-new Date(a.server_modified));

  container.innerHTML="";
  for(const e of entries){
    let data={}; try{data=await downloadFile(e.path_lower);}catch{}
    if(!data.status) data.status="New Order";

    const div=document.createElement("div");
    div.className="order";
    div.innerHTML=`
      <strong>${data.name||""}</strong>
      <div class="meta">üìû ${data.phone||""}</div>
      <div class="meta">üìç ${data.address||""}</div>
      <div class="items">üõí ${data.items||""}</div>
      <span class="status-badge ${data.status==="New Order"?"new":data.status==="Packaged"?"packaged":"delivered"}">${data.status}</span><br>
      <label>Change Status:</label>
      <select data-path="${e.path_lower}">
        <option ${data.status==="New Order"?"selected":""}>New Order</option>
        <option ${data.status==="Packaged"?"selected":""}>Packaged</option>
        <option ${data.status==="Delivered"?"selected":""}>Delivered</option>
      </select><br>
      üí∞ Total: ‡ß≥${data.total||0}<br>
      <small>${data.createdAt||e.server_modified}</small><br>
      <button data-del="${e.path_lower}">Delete</button>
    `;
    container.appendChild(div);
  }

  // delete buttons
  document.querySelectorAll("button[data-del]").forEach(btn=>{
    btn.onclick=async()=>{
      if(confirm("Delete this order?")){await deleteFile(btn.dataset.del); renderOrders();}
    };
  });

  // status change
  document.querySelectorAll("select[data-path]").forEach(sel=>{
    sel.onchange=async()=>{
      const path=sel.dataset.path;
      let data=await downloadFile(path);
      data.status=sel.value;
      await uploadFile(path,data);
      renderOrders();
    };
  });
}

/* Revenue Page */
async function calcRevenue(){
  document.getElementById("total").textContent="Calculating...";
  const list=await listFiles();
  let total=0;
  for(const e of list.entries||[]){
    if(e[".tag"]!=="file"||!e.name.endsWith(".json")) continue;
    const data=await downloadFile(e.path_lower).catch(()=>({}));
    total+=parseFloat(data.total||0);
  }
  document.getElementById("total").textContent="‡ß≥"+total.toFixed(2);
}

/* Navigation */
function showPage(page){
  document.getElementById("ordersPage").style.display= page==="orders"?"block":"none";
  document.getElementById("revenuePage").style.display= page==="revenue"?"block":"none";
  document.getElementById("navOrders").classList.toggle("active",page==="orders");
  document.getElementById("navRevenue").classList.toggle("active",page==="revenue");
}
document.getElementById("navOrders").onclick=(e)=>{e.preventDefault();showPage("orders");};
document.getElementById("navRevenue").onclick=(e)=>{e.preventDefault();showPage("revenue");};

document.getElementById("refreshOrders").onclick=renderOrders;
document.getElementById("refreshRevenue").onclick=calcRevenue;
</script>
</body>
</html>
